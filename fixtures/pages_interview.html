<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Read-only Code Challenge Viewer — Watermarked</title>
  <style>
    :root{--wm-opacity:0.12;--wm-color:#000;--wm-font:600 18px/1.2 system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    html,body{height:100%;margin:0;background:#fff;font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;color:#111}
    .container{position:relative;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box}

    /* Image frame */
    .frame{position:relative;max-width:1000px;width:100%;box-shadow:0 6px 30px rgba(0,0,0,0.08);border-radius:8px;overflow:hidden;background:#fafafa}
    .frame img{display:block;width:100%;height:auto;user-select:none;-webkit-user-drag:none}

    /* Watermark layer (tiles generated by JS) */
    .watermark-layer{pointer-events:none;position:absolute;inset:0;z-index:40;mix-blend-mode:normal}
    .watermark-tile{position:absolute;white-space:nowrap;opacity:var(--wm-opacity);font:var(--wm-font);color:var(--wm-color);transform:rotate(-20deg);letter-spacing:0.06em}

    /* Top legal / click-through bar */
    .topbar{position:relative;z-index:60;background:linear-gradient(90deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));padding:8px 12px;font-size:13px;display:flex;gap:12px;align-items:center;justify-content:space-between;border-radius:8px 8px 0 0}
    .topbar .notice{font-weight:600}
    .agree-btn{background:#0b5cff;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}

    /* Bottom footer with legal PI text */
    .footer{font-size:13px;padding:12px;color:#222;background:linear-gradient(180deg, rgba(255,255,255,0.8), rgba(255,255,255,0.95));display:flex;gap:12px;align-items:center;justify-content:space-between}
    .footer .legal{max-width:800px}

    /* Blackout overlay when screenshot attempt or focus loss detected */
    .blackout{position:absolute;inset:0;background:#000;z-index:120;opacity:0;transition:opacity .12s ease}
    .blackout.active{opacity:1}

    /* Helper: visually hide controls for printing / selection */
    @media print{body *{visibility:hidden} .frame, .frame *{visibility:visible}}
  </style>
</head>
<body>
  <div class="container">
    <div class="frame" id="frame">
      <div class="topbar" id="topbar">
        <div class="notice">CONFIDENTIAL — Please read the legal note before viewing</div>
        <button class="agree-btn" id="agreeBtn">I agree — View challenge</button>
      </div>

      <!-- Image area: replace src with your generated PNG/JPG of the code -->
      <div id="imageWrap" style="position:relative;">
        <img id="codeImage" src="/DE_medior_interview.png" alt="Code snippet (view-only)"/>

        <!-- watermark tiles injected here -->
        <div class="watermark-layer" id="wmLayer" aria-hidden="true"></div>

        <!-- blackout overlay (used for PrintScreen key detection / focus loss) -->
        <div class="blackout" id="blackout"></div>
      </div>

      <div class="footer">
        <div class="legal">Personal data / proprietary information (PI) is strictly prohibited from being copied, photographed, or shared. Any disclosure is a violation of policy and may lead to disqualification and further action.</div>
        <div class="meta" id="meta">Session: <span id="sessionId">—</span> • <span id="timestamp">—</span></div>
      </div>
    </div>
  </div>

  <script>
    /*******************************************************************
     * Read-only Code Challenge Viewer
     * Usage notes (quick):
     * - Replace the <img id="codeImage" src="..."> with your generated
     *   PNG/JPG of the code snippet (use a syntax highlighter and export)
     * - Preferably generate a unique URL for each candidate that includes
     *   query-string params: ?name=...&email=...&vendor=...&session=...&ts=...
     * - This page uses those params (if present) to populate watermark text.
     * - Add server-side protections: single-use token, short expiry, logging.
     *******************************************************************/

    // Read candidate/session info from URL query params (fallback to placeholders)
    function qs(name){const u=new URLSearchParams(location.search);return u.get(name)||''}
    const candidateName = decodeURIComponent(qs('name') || 'Candidate Name');
    const candidateEmail = decodeURIComponent(qs('email') || 'candidate@example.com');
    const vendor = decodeURIComponent(qs('vendor') || 'Vendor');
    const sessionId = decodeURIComponent(qs('session') || Math.random().toString(36).slice(2,10));
    const ts = decodeURIComponent(qs('ts') || new Date().toISOString());

    // DOM refs
    const wmLayer = document.getElementById('wmLayer');
    const sessionSpan = document.getElementById('sessionId');
    const tsSpan = document.getElementById('timestamp');
    const agreeBtn = document.getElementById('agreeBtn');
    const topbar = document.getElementById('topbar');
    const blackout = document.getElementById('blackout');
    const frame = document.getElementById('frame');
    const imageWrap = document.getElementById('imageWrap');

    sessionSpan.textContent = sessionId;
    tsSpan.textContent = (new Date(ts)).toLocaleString();

    // Build watermark text
    const wmText = `CONFIDENTIAL — ${candidateName} | ${candidateEmail} | ${vendor} | session:${sessionId} | ${new Date(ts).toLocaleString()}`;

    // generate tiled watermark across the frame
    function createWatermarkTiles(){
      wmLayer.innerHTML = '';
      const rect = imageWrap.getBoundingClientRect();
      const tileW = 360; // approx tile width
      const tileH = 80;
      const cols = Math.ceil(rect.width / tileW) + 1;
      const rows = Math.ceil(rect.height / tileH) + 1;
      for(let r= -1; r<rows; r++){
        for(let c=-1; c<cols; c++){
          const el = document.createElement('div');
          el.className = 'watermark-tile';
          el.textContent = wmText;
          el.style.left = (c * tileW * 0.6) + 'px';
          el.style.top = (r * tileH * 0.9) + 'px';
          el.style.transform = 'rotate(-20deg)';
          el.style.opacity = getComputedStyle(document.documentElement).getPropertyValue('--wm-opacity');
          wmLayer.appendChild(el);
        }
      }
    }

    // Recreate tiles on resize
    let resizeTimer = null; window.addEventListener('resize', ()=>{clearTimeout(resizeTimer);resizeTimer=setTimeout(createWatermarkTiles,120)});

    // Basic deterrents: disable right-click, selection and common shortcuts
    document.addEventListener('contextmenu', e=>{e.preventDefault();return false});
    document.addEventListener('copy', e=>{e.preventDefault();return false});
    document.addEventListener('keydown', e=>{
      // Block Save / Print / DevTools shortcuts
      if ((e.ctrlKey || e.metaKey) && (e.key === 's' || e.key === 'p' || e.key === 'S' || e.key === 'P')){e.preventDefault();return false}
      if ((e.ctrlKey || e.metaKey) && (e.shiftKey) && (e.key === 'I' || e.key === 'i')){e.preventDefault();return false}
      // Detect Print Screen key (often 'PrintScreen' or keyCode 44)
      if (e.key === 'PrintScreen' || e.keyCode === 44){triggerBlackout(900)}
    });

    // When the tab loses focus (candidate Alt-Tabs), briefly blackout
    window.addEventListener('blur', ()=>{triggerBlackout(1200)});

    // Visibility change: possible that external screenshot apps trigger it
    document.addEventListener('visibilitychange', ()=>{ if (document.hidden) triggerBlackout(900) });

    // Blackout helper
    let blackoutTimer = null;
    function triggerBlackout(ms){
      blackout.classList.add('active');
      clearTimeout(blackoutTimer);
      blackoutTimer = setTimeout(()=>{blackout.classList.remove('active')}, ms || 700);
      // Optional: log event to server (example - requires server endpoint)
      // navigator.sendBeacon('/log-screenshot-attempt', JSON.stringify({session:sessionId,ts:new Date().toISOString()}));
    }

    // Make sure tiles are created only after user agrees (click-through)
    agreeBtn.addEventListener('click', ()=>{
      agreeBtn.disabled = true;agreeBtn.textContent = 'Viewing — session logged';
      // Fade out topbar slightly (but keep notice visible)
      topbar.style.opacity = '0.95';
      // create watermarks
      createWatermarkTiles();
      // Optional: send server-side 'viewed' event
      try{navigator.sendBeacon && navigator.sendBeacon('/log-view',{session:sessionId});}catch(e){}
    });

    // Initialize: create a small set of watermark tiles so the page is ready but requires agree
    createWatermarkTiles();

    // Accessibility: let users with keyboard navigate to the agree button first
    agreeBtn.focus();
  </script>
</body>
</html>
